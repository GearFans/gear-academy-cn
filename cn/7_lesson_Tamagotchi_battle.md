第 7 课：Tamagotchi 战斗逻辑与实施

课程总结

-   本课的重点是促进两个电子宠物之间战斗的契约。

-   战斗契约可以处于四种状态之一：Registration、Moves、Waiting 和
    GameIsOver。

-   Battle 结构包含有关玩家的信息、游戏的当前状态、当前回合、Tamagotchi
    商店 ID、获胜者以及到目前为止所走的步数。

-   要参与游戏，用户必须允许他们的合约接收与游戏相关的消息，如
    TmgAction::TmgInfo 和 StoreAction::GetAttributes。

-   注册函数从商店获取电子宠物主人的信息及其属性，随机生成电子宠物的力量和能量，并注册电子宠物。

-   get_owner 和 get_attributes 函数分别从商店中检索有关 Tamagotchi
    所有者和属性的信息，而 get_turn 和 generate_power
    函数分别生成伪随机数以确定谁开始游戏和 Tamagotchi 的功率。

课程目标

在课程结束时，您将：

-   理解促成两个电子宠物之间战斗的契约。

-   了解 Battle
    结构体中包含的信息，例如玩家信息、游戏状态、获胜者和到目前为止所走的步数。

-   领悟战斗契约状态并理解它们的作用

-   了解用于从商店检索信息和生成伪随机数的函数，例如
    get_owner、get_attributes、get_turn 和 generate_power。

-   完成宠物蛋对战的简单实现

让我们开始吧！

战斗契约可以有3种状态：

-   注册：战斗契约等待电子宠物主人注册；

-   移动：Tamagotchi 所有者轮流移动；

-   等待：在电子宠物主人采取行动后，战斗契约让他们有时间装备电子宠物。

-   GameIsOver：战斗结束，需要发送消息StartNewGame。

[代码占位符]

战斗程序状态：

[代码占位符]

玩家是以下结构的地方：

[代码占位符]

要参与，用户必须允许他们的合约接收与游戏相关的消息，如下所示：

[代码占位符]

它将响应有关电子鸡所有者的信息：

[代码占位符]

我们还将添加消息

[代码占位符]

到允许我们获得 Tamagotchi 属性的商店合约

[代码占位符]

注册函数：

它允许注册两个 Tamagotchi 进行战斗。

[图像占位符]

1.  在您注册宠物蛋之前，战斗合约必须从商店接收宠物蛋的所有者及其属性；

2.  收到详情后，战斗契约随机生成电子宠物的力量和能量；

3.  如果一只电子鸡被注册，它会保持在注册状态；

4.  如果注册了两个 Tamagotchi，战斗契约将随机确定谁先开始游戏并进入
    Moves 状态。

[代码占位符]

get_owner 函数从 Tamagotchi 合约中检索 Tamagotchi 的所有者。

[代码占位符]

同样，get_attributes 函数从商店中检索 Tamagotchi 的属性。

[代码占位符]

为了确定哪个玩家开始游戏，我们使用 get_turn 函数，它伪随机选择起始玩家：

[代码占位符]

genetate_power 函数伪随机生成电子宠物的功率值：

[代码占位符]

还有两个常量 MAX_POWER 和 MIN_POWER，它们定义了 Tamagotchi
功率的上限和下限：

[代码占位符]

接下来，作为例子，我们将定义一个非常简单的游戏机制：

1.  Tamagotchi 所有者只需向战斗合约发送一条消息 BattleAction::Move
    即可采取行动。在那一步中，他们的 Tamagotchi 击败了对手的
    Tamagotchi。对手的能量会随着攻击的力量而减少。

2.  现在，电子鸡商店里只有一个属性可以在游戏中使用——一把剑。如果攻击的电子宠物有剑，其攻击力乘以
    SWORD_POWER：

SWORD_POWER * 功率

否则玉子的攻击力简直就是他们的力量。

以后可以通过在商店中添加战斗属性来扩展逻辑，还可以添加电子宠物在场地上的移动。

3.  如果两个玩家都进行了三步，游戏进入等待状态，玩家可以从商店购买物品来装备他们的电子宠物。经过一段设定的延迟后，Tamagotchis
    的状态会更新，下一轮开始。

[图像占位符]

[代码占位符]

UpdateInfo 操作只是更新 Tamagotchi 状态的变化并开始下一轮：

[代码占位符]

至此，电子鸡对战的简单实现就完成了。

您可以尝试与您的宠物蛋一起战斗，或者创建一些电子宠物蛋（使用上一课）并让它们战斗（链接到网络应用程序）。

现在是你的课程作业时间。

课程作业：

-   为商店契约增加更多的战斗属性；

-   确定这些属性的力量。您还可以添加升级各种属性的机会（这也需要扩展商店合约的逻辑）；

-   允许玩家选择他将在回合中战斗或防御的武器；

-   也可以为 Tamagotchi 添加向左或向右移动的能力；

-   发挥创意并考虑其他可能的方法来使游戏更有趣。

[Google 翻译]

原文

To participate in the game, users must allow their contracts to receive
game-related messages like TmgAction::TmgInfo and
StoreAction::GetAttributes.

提供更好的翻译建议

------------------------------------------------------------------------
